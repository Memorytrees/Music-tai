<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>音悦台</title>
    <link rel="stylesheet" href="css/tai.css">
</head>
<body>
    <div id="wrap">
        <div class="head">
            <div class="head-top">
                <!-- logo -->
                <h1 class="logo">
                    <a href="http://www.atguigu.com">
                        <img src="img/logo.png">
                    </a>
                </h1>
                <!-- 面包屑导航 -->
                <a href="javascript:;" class="menuBtn"></a>
                <!-- 按钮排 -->
                <div class="btns">
                    <a href="javascript:;" class="search">搜索</a>
                    <a href="javascript:;">登录</a>
                    <a href="javascript:;">注册</a>
                </div>
            </div>
            <div class="head-bottom">
                <form method="post">
                    <input type="text" placeholder="请碰我一下">
                    <input type="submit" value="搜索">
                </form>
            </div>
            <ul class="mask">
                <li>
                    <a href="javascript:;">首页</a>
                </li>
                <li>
                    <a href="javascript:;">MV</a>
                </li>
                <li>
                    <a href="javascript:;">悦单</a>
                </li>
                <li>
                    <a href="javascript:;">V榜</a>
                </li>
                <li>
                    <a href="javascript:;">音乐</a>
                </li>
                <li>
                    <a href="javascript:;">商城</a>
                </li>
                <li>
                    <a href="javascript:;">节目</a>
                </li>
                <li>
                    <a href="javascript:;">饭团</a>
                </li>
                <li>
                    <a href="javascript:;">咨询</a>
                </li>
                <li>
                    <a href="javascript:;">我的家</a>
                </li>
                <li>
                    <a href="javascript:;">APP下载</a>
                </li>
                <li>
                    <a href="javascript:;">热门应用</a>
                </li>
            </ul>
        </div>
        <div class="content">
            <!-- 导航 -->
            <div class="nav">
                <ul class="list">
                    <li class="active">
                        <a href="javascript:;">首页</a>
                    </li>
                    <li>
                        <a href="javascript:;">MV</a>
                    </li>
                    <li>
                        <a href="javascript:;">悦单</a>
                    </li>
                    <li>
                        <a href="javascript:;">V榜</a>
                    </li>
                    <li>
                        <a href="javascript:;">音乐</a>
                    </li>
                    <li>
                        <a href="javascript:;">商城</a>
                    </li>
                    <li>
                        <a href="javascript:;">节目</a>
                    </li>
                    <li>
                        <a href="javascript:;">饭团</a>
                    </li>
                    <li>
                        <a href="javascript:;">咨询</a>
                    </li>
                    <li>
                        <a href="javascript:;">我的家</a>
                    </li>
                    <li>
                        <a href="javascript:;">APP下载</a>
                    </li>
                    <li>
                        <a href="javascript:;">热门应用</a>
                    </li>
                    <li>
                        <a href="javascript:;">小飞张</a>
                    </li>
                    <li>
                        <a href="javascript:;">京龙油</a>
                    </li>
                    <li>
                        <a href="javascript:;">北师大</a>
                    </li>
                    <li>
                        <a href="javascript:;">法兰西</a>
                    </li>
                    <li>
                        <a href="javascript:;">张无忌</a>
                    </li>
                </ul>
            </div>
            <!-- 无缝滑屏 -->
            <div class="carousel-wrap" needAuto needCarousel>
                <div class="points-wrap"></div>
            </div>
            <!-- Tap选项卡 -->
            <div class="tap-wrap">
                <div class="tap-head">
                    <h2>MV主播</h2>
                    <span>更多&gt;</span>
                </div>
                <div class="tap-nav">
                    <a href="javascript;:">全部</a>
                    <a href="javascript;:">内地</a>
                    <a href="javascript;:">欧美</a>
                    <a href="javascript;:">韩国</a>
                    <a href="javascript;:">日本</a>
                    <a href="javascript;:">港台</a>
                    <div class="smallG"></div>
                </div>
                <div class="tap-content">
                    <ul class="tap-loading"></ul>
                    <ul>
                        <li>
                            <a href="javascript:;">
                                <img src="img/a.jpg">
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/b.jpg">
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/c.jpg">
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/d.jpg">
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/e.jpg">
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/f.jpg">
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <ul class="tap-loading"></ul>
                </div>
            </div>

            <!-- Tap选项卡 -->
            <div class="tap-wrap">
                <div class="tap-head">
                    <h2>MV主播</h2>
                    <span>更多&gt;</span>
                </div>
                <div class="tap-nav">
                    <a href="javascript;:">全部</a>
                    <a href="javascript;:">内地</a>
                    <a href="javascript;:">欧美</a>
                    <a href="javascript;:">韩国</a>
                    <a href="javascript;:">日本</a>
                    <a href="javascript;:">港台</a>
                    <div class="smallG"></div>
                </div>
                <div class="tap-content">
                    <ul>
                        <li>
                            <a href="javascript:;">
                                <img src="img/a.jpg">
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/b.jpg">
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/c.jpg">
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/d.jpg">
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/e.jpg">
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/f.jpg">
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>   

            

            
            
        </div>
    </div>
</body>
    <script src="js/tools.js"></script>
    <script src="js/damu.js"></script>
    <script type="text/javascript">
        window.onload = function() {
            document.addEventListener("touchstart", function(ev) {
                ev = ev||event;
                ev.preventDefault();
            })

            ;(function() {
                var styleNode = document.createElement("style");
                var w = document.documentElement.clientWidth/16;
                styleNode.innerHTML = "html{font-size:" + w + "px!important}";
                document.head.appendChild(styleNode);
            })()

            // // Tap选项卡
            // function tap();
            // function tap() {}

            changeFocus()
			function changeFocus(){
				var inputText = document.querySelector("#wrap .head .head-bottom form input[type='text']");
				inputText.addEventListener("touchstart",function(ev){
					ev=ev||event;
					this.focus();
					ev.stopPropagation();
					ev.preventDefault();
				})
				document.addEventListener("touchstart",function(){
					inputText.blur();
				})
            }
            
            
            // 导航点击变色  事件委托的根本机制就是冒泡
            changeColor();
            function changeColor() {
                var list = document.querySelector("#wrap .content .nav .list");
                var liNodes = document.querySelectorAll("#wrap .content .nav .list>li");
                list.addEventListener("touchend", function(ev){
                    ev = ev || event;
                    var touchC = ev.changedTouches[0];
                    for(var i=0;i<liNodes.length;i++){
                        tools.removeClass(liNodes[i], "active");
                    }
                    if(touchC.target.nodeName.toUpperCase()==="A"){
                        tools.addClass(touchC.target.parentNode, "active");
                    }else if(touchC.target.nodeName.toUpperCase()==="LI"){
                        tools.addClass(touchC.target, "active");
                    }
                })
            }


            //做法一(不推荐)
            // function changeColor() {
            //     var liNodes = document.querySelectorAll("#wrap .content .nav .list>li");
            //     for(var i=0; i<liNodes.length; i++){
                    
            //         liNodes[i].addEventListener("touchstart", function(){
            //             this.isMove = false;
            //         })
            //         liNodes[i].addEventListener("touchmove", function(){
            //             this.isMove = true;
            //         })
            //         liNodes[i].addEventListener("touchend", function(){
            //             if(!this.isMove){
            //                 for(var i=0; i<liNodes.length; i++){
            //                     tools.removeClass(liNodes[i], "active");
            //                 }
            //                 tools.addClass(this, "active");
            //             }
            //         })
            //     }
            // }
            

			
            // 无缝滑屏
            swiper();
            function swiper() {
                var arr = ["img/1.jpg","img/2.jpg","img/3.jpg","img/4.jpg","img/5.jpg"]
                damu.carousel(arr);
            }
            

            // 可拖拽的导航
            drag();
            function drag() {
                // 滑屏区域
                var wrap = document.querySelector("#wrap .content .nav");
                // 滑屏元素
                var item = document.querySelector("#wrap .content .nav .list");
                // 元素一开始的位置  手指一开始的位置
                var startX = 0;
                var elementX =0;
                var minX = wrap.clientWidth - item.offsetWidth;

                // 快速滑屏的必要参数
                var lastTime = 0;
                var nowTime = 0;
                var lastPoint = 0;
                var nowPoint = 0;
                var timeDis = 1;
                var pointDis = 0;

                wrap.addEventListener("touchstart", function(ev){
                    ev = ev||event;
                    var touchC = ev.changedTouches[0];
                    startX = touchC.clientX;
                    elementX = damu.css(item, "translateX");
                    item.style.transition = "none";

                    lastTime = new Date().getTime();
                    // lastPoint = damu.css(item, "translateX");
                    lastPoint = touchC.clientX;

                    
                    // 清除速度的残留
                    pointDis = 0;
                    item.handMove = false;
                })

                wrap.addEventListener("touchmove", function(ev){
                    ev = ev||event;
                    var touchC = ev.changedTouches[0];
                    var nowX = touchC.clientX;
                    var disX = nowX - startX;
                    translateX = elementX+disX;


                    nowTime = new Date().getTime();
                    nowPoint = touchC.clientX;
                    // nowPoint = damu.css(item, "translateX");
                    timeDis = nowTime - lastTime;
                    pointDis = nowPoint - lastPoint;

                    lastTime = nowTime;
                    lastPoint = nowPoint;

                    // 橡皮效果
                    // 在move的过程中，每一次touchmove真正的有效距离在慢慢变小
                    // 元素的滑动距离还是在变大

                    if(translateX > 0) {
                        item.handMove = true;
                        // var scale = 1 - translateX/document.documentElement.clientWidth;
                        var scale = document.documentElement.clientWidth / ((document.documentElement.clientWidth + translateX)*1.5);
                        // translateX = elementX + disX * scale;
                        translateX = damu.css(item, "translateX") + pointDis * scale;
                        // translateX = 0;
                    }else if(translateX < minX) {
                        item.handMove = true;
                        var over = minX - translateX;
                        var scale = document.documentElement.clientWidth / ((document.documentElement.clientWidth + over)*1.5);
                        translateX = damu.css(item, "translateX") + pointDis * scale;
                        // translateX = elementX + pointDis * scale;
                        // translateX = elementX + disX * scale;
                        // translateX = minX;
                    }
                    damu.css(item, "translateX", translateX);

                    

                })

                wrap.addEventListener("touchend", function(ev){
                    var translateX = damu.css(item, "translateX");
                    if(!item.handMove) {
                        
                        // 速度越快  位移越远
                        var speed = pointDis / timeDis;
                        speed = Math.abs(speed)<0.5?0:speed;
                        var targetX = translateX + speed*200;
                        // console.log(speed);
                        
                        time = Math.abs(speed)*0.2;
                        time = time<0.8?0.8:time;
                        time = time>2?2:time;
                        // 快速滑屏的橡皮筋效果
                        var bsr = "";
                        if(targetX > 0) {
                            targetX = 0;
                            bsr = "cubic-bezier(.26,1.51,.68,1.54)";
                        }else if(targetX < minX) {
                            targetX = minX;
                            bsr = "cubic-bezier(.26,1.51,.68,1.54)";
                        }

                        item.style.transition = time+"s "+bsr+" transform";
                        damu.css(item, "translateX", targetX);
                    }else {
                        // 手动橡皮筋效果
                        item.style.transition = "1s transform";
                        if(translateX>0){
                            translateX = 0;
                            damu.css(item, "translateX", translateX);
                        }else if(translateX < minX){
                            translateX = minX;
                            damu.css(item, "translateX", translateX);
                        }
                    }
                })
            }
           
            CMCFMenuBtn();
            function CMCFMenuBtn() {
                var menuBtn = document.querySelector("#wrap .head .head-top .menuBtn");
                var mask = document.querySelector("#wrap .head .mask");
                // isXX : false  频道按钮
                // isXX : true   XX按钮
                var isXX = false;
                menuBtn.addEventListener("touchstart", function(ev) {
                    ev = ev || event;
                    var touchC = ev.changedTouches[0];
                    if(!isXX) {
                        tools.addClass(menuBtn,"active");
                        mask.style.display = "block";
                    }else {
                        tools.removeClass(menuBtn,"active");
                        mask.style.display = "none";
                    }
                    isXX = !isXX;
                    ev.stopPropagation();
                    ev.preventDefault();
                })
                
                document.addEventListener("touchstart", function() {
                    if(isXX) {
                        tools.removeClass(menuBtn, "active");
                        mask.style.display = "none";
                        isXX = !isXX;
                    }
                })

                mask.addEventListener("touchstart",function(ev){
					ev = ev||event;
					ev.stopPropagation();
					ev.preventDefault();
				})
            }
        }
    </script>

</html>